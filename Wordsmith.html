<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Wordsmith — Full Game</title>
<style>
  :root{--bg:#07101a;--card:#0b1220;--accent:#ffb86b;--muted:#9aa5b1;--ok:#2ecc71;--bad:#ff6b6b}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#061018,#071627);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#e6eef6}
  .wrap{max-width:980px;margin:12px auto;padding:14px;background:rgba(255,255,255,0.02);border-radius:12px}
  header{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
  h1{margin:0;color:var(--accent);font-size:20px}
  .meta{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .pill{background:#071b24;padding:6px 10px;border-radius:999px;color:var(--muted);font-size:13px}
  main{margin-top:12px;display:flex;gap:12px;flex-wrap:wrap}
  .left{flex:1;min-width:280px}
  .card{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px}
  .words{display:flex;flex-direction:column;gap:10px;margin-top:12px}
  .row{display:flex;gap:10px;align-items:flex-start}
  .num{width:40px;height:40px;border-radius:8px;background:#071b24;display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--accent)}
  .btn{flex:1;text-align:left;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:15px}
  .btn.disabled{opacity:.5;pointer-events:none}
  .controls{display:flex;gap:8px;align-items:center;margin-top:10px}
  button{padding:10px 12px;border-radius:8px;border:none;background:#0b2830;color:#e6eef6;font-weight:600}
  button.primary{background:var(--accent);color:#07101a}
  .status{margin-top:10px;font-size:14px;color:var(--muted)}
  .msg{margin-top:10px;padding:10px;border-radius:8px;font-weight:700}
  .ok{background:rgba(46,204,113,0.12);color:var(--ok)}
  .bad{background:rgba(255,107,107,0.08);color:var(--bad)}
  aside{width:320px;min-width:260px}
  .stat{display:flex;justify-content:space-between;padding:10px;border-radius:8px;background:rgba(255,255,255,0.015);margin-bottom:8px}
  .small{font-size:13px;color:var(--muted)}
  .forgeBox{margin-top:12px;padding:10px;border-radius:8px;background:rgba(255,255,255,0.01)}
  footer{margin-top:12px;color:var(--muted);font-size:13px}
  @media (max-width:900px){aside{width:100%}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>⚒️ Wordsmith</h1>
      <div class="meta">
        <div class="pill" id="tierPill">Tier: Novice</div>
        <div class="pill" id="tierPointsPill">Tier points: 0</div>
        <div class="pill" id="setPill">Set: 1/3</div>
      </div>
    </header>

    <main>
      <div class="left">
        <div class="card">
          <div class="small">Block set <strong id="globalSet">1</strong> — choose the fake word</div>
          <div id="words" class="words" aria-live="polite"></div>

          <div class="controls">
            <button id="useToolbox">Use Toolbox</button>
            <button id="nextBtn" class="primary" style="margin-left:auto" disabled>Next</button>
          </div>

          <div id="message" class="status"></div>
          <div id="explain" class="small"></div>
        </div>
      </div>

      <aside>
        <div class="card">
          <div class="stat"><div>Tier</div><div id="tierLabel">Novice</div></div>
          <div class="stat"><div>Sets in block</div><div id="setInBlock">1 / 3</div></div>
          <div class="stat"><div>Tier points</div><div id="tierPts">0</div></div>
          <div class="stat"><div>Toolbox available</div><div id="tbAvail">Yes</div></div>

          <div style="margin-top:8px" class="small"><strong>Toolbox</strong>: once per 3-set block. Tap "Use Toolbox" then tap the numbered word you want revealed; I will tell you whether that word is real or fake. Numbers stay fixed for the set.</div>
          <div style="margin-top:10px" class="small"><strong>Forge Word</strong>: shown after 3 sets. Guess real or fake. Correct = +1 tier point (no penalty if wrong).</div>

          <div style="margin-top:12px" class="small"><strong>Controls</strong>: Tap a numbered word to guess the fake. After a guess, tap Next to proceed. Use Toolbox when available to reveal one word in the set (no downside).</div>
        </div>
      </aside>
    </main>

    <footer>
      <div class="small">Words are tracked so sets remain fresh — no repeats in a run until pools need to recycle.</div>
    </footer>
  </div>

<script>
/* Wordsmith — full single-file game
   - Tiers: Novice, Apprentice, Journeyman, Master
   - 3 sets per block; each set = 4 words (3 real + 1 fake)
   - Toolbox once per 3-set block; stable numbering
   - Forge word after block
   - Fresh words (no repeats) tracked across a run
*/

// ---------- Helpers ----------
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }
function pickRandom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

// ---------- Tier & Pools ----------
const TIERS = ['Novice','Apprentice','Journeyman','Master'];
let tierIndex = 0; // start Novice

// Real word pools (tiered). Each entry: {word,pos,def}
// --- NOVICE (very common)
const REAL_NOVICE = [
  {word:"apple",pos:"noun",def:"A round fruit with red, green, or yellow skin."},
  {word:"ball",pos:"noun",def:"A round object used in play or sport."},
  {word:"bed",pos:"noun",def:"A piece of furniture for sleeping on."},
  {word:"book",pos:"noun",def:"A set of written or printed pages bound together."},
  {word:"bread",pos:"noun",def:"A food made of flour and water, baked."},
  {word:"car",pos:"noun",def:"A road vehicle, typically with four wheels, powered by an engine."},
  {word:"cat",pos:"noun",def:"A small domesticated carnivorous mammal."},
  {word:"chair",pos:"noun",def:"A separate seat for one person, typically with a back and four legs."},
  {word:"child",pos:"noun",def:"A young human being below the age of puberty."},
  {word:"dog",pos:"noun",def:"A domesticated carnivorous mammal, often kept as a pet."},
  {word:"door",pos:"noun",def:"A movable barrier for opening and closing an entrance."},
  {word:"ear",pos:"noun",def:"The organ of hearing."},
  {word:"eye",pos:"noun",def:"The organ of sight."},
  {word:"fire",pos:"noun",def:"The phenomenon of combustion producing heat and light."},
  {word:"flower",pos:"noun",def:"The seed-bearing part of a plant, often brightly colored."},
  {word:"foot",pos:"noun",def:"The lower extremity of the leg."},
  {word:"glass",pos:"noun",def:"A hard, brittle, transparent substance used for windows and containers."},
  {word:"green",pos:"adjective",def:"The color between blue and yellow in the spectrum; of plants."},
  {word:"hand",pos:"noun",def:"The end part of a human arm used for grasping."},
  {word:"house",pos:"noun",def:"A building for human habitation."},
  {word:"job",pos:"noun",def:"A paid position of regular employment."},
  {word:"laugh",pos:"verb",def:"To make sounds and movements of joy or amusement."},
  {word:"milk",pos:"noun",def:"A white liquid produced by mammals to feed their young."},
  {word:"moon",pos:"noun",def:"The natural satellite of the Earth."},
  {word:"mother",pos:"noun",def:"A female parent."},
  {word:"mountain",pos:"noun",def:"A large natural elevation of the earth's surface."},
  {word:"rain",pos:"noun",def:"Drops of water that fall from clouds."},
  {word:"red",pos:"adjective",def:"The color of blood or ripe strawberries."},
  {word:"road",pos:"noun",def:"A wide way leading from one place to another."},
  {word:"run",pos:"verb",def:"To move at a speed faster than a walk."},
  {word:"school",pos:"noun",def:"An institution for educating children."},
  {word:"shoe",pos:"noun",def:"A covering for the foot."},
  {word:"sleep",pos:"verb",def:"To rest by suspending consciousness."},
  {word:"small",pos:"adjective",def:"Of a size that is less than normal or usual."},
  {word:"star",pos:"noun",def:"A luminous point in the night sky."},
  {word:"street",pos:"noun",def:"A public road in a built-up area."},
  {word:"sun",pos:"noun",def:"The star at the center of our solar system."},
  {word:"table",pos:"noun",def:"A piece of furniture with a flat top and legs."},
  {word:"tree",pos:"noun",def:"A woody perennial plant typically having a single stem."},
  {word:"village",pos:"noun",def:"A small group of houses in a rural area."},
  {word:"walk",pos:"verb",def:"To move at a regular pace by lifting and setting down each foot."},
  {word:"water",pos:"noun",def:"A clear liquid essential for life."},
  {word:"work",pos:"verb",def:"To engage in physical or mental effort as a job."},
  {word:"play",pos:"verb",def:"To engage in an activity for enjoyment."},
  {word:"eat",pos:"verb",def:"To take food into the mouth and swallow it."},
  {word:"drink",pos:"verb",def:"To take liquid into the mouth and swallow."},
  {word:"child",pos:"noun",def:"A young human being (duplicate removed if needed)."}
];

// --- APPRENTICE (still common, slightly less everyday)
const REAL_APPRENTICE = [
  {word:"abate",pos:"verb",def:"To become less intense or widespread."},
  {word:"altruistic",pos:"adjective",def:"Showing selfless concern for the well-being of others."},
  {word:"ambivalent",pos:"adjective",def:"Having mixed feelings or contradictory ideas about something."},
  {word:"anomaly",pos:"noun",def:"Something that deviates from what is standard or expected."},
  {word:"auspicious",pos:"adjective",def:"Conducive to success; favorable."},
  {word:"benevolent",pos:"adjective",def:"Well-meaning and kindly."},
  {word:"candid",pos:"adjective",def:"Truthful and straightforward; frank."},
  {word:"catalyst",pos:"noun",def:"Something that precipitates an event or change."},
  {word:"copious",pos:"adjective",def:"Abundant in supply or quantity."},
  {word:"decorum",pos:"noun",def:"Behavior in keeping with good taste and propriety."},
  {word:"deride",pos:"verb",def:"To express contempt for; ridicule."},
  {word:"diligent",pos:"adjective",def:"Showing care and conscientiousness in one's work."},
  {word:"eloquent",pos:"adjective",def:"Fluent or persuasive in speaking or writing."},
  {word:"emulate",pos:"verb",def:"To match or surpass by imitation."},
  {word:"ephemeral",pos:"adjective",def:"Lasting for a very short time."},
  {word:"fervent",pos:"adjective",def:"Having or displaying passionate intensity."},
  {word:"fortuitous",pos:"adjective",def:"Happening by chance, often with a beneficial outcome."},
  {word:"impartial",pos:"adjective",def:"Treating all rivals or disputants equally; fair."},
  {word:"lucid",pos:"adjective",def:"Expressed clearly; easy to understand."},
  {word:"mitigate",pos:"verb",def:"To make less severe, serious, or painful."},
  {word:"pensive",pos:"adjective",def:"Engaged in deep or serious thought."},
  {word:"placid",pos:"adjective",def:"Not easily upset or excited; calm and peaceful."},
  {word:"pragmatic",pos:"adjective",def:"Dealing with things sensibly and realistically."},
  {word:"prudent",pos:"adjective",def:"Acting with or showing care for the future."},
  {word:"rectify",pos:"verb",def:"To correct or make right."},
  {word:"resolve",pos:"verb",def:"To settle or find a solution to a problem."},
  {word:"reticent",pos:"adjective",def:"Not revealing one's thoughts readily; reserved."},
  {word:"salient",pos:"adjective",def:"Most noticeable or important."},
  {word:"succinct",pos:"adjective",def:"Expressed in few words; concise."},
  {word:"taciturn",pos:"adjective",def:"Reserved or uncommunicative in speech."},
  {word:"tranquil",pos:"adjective",def:"Free from disturbance; calm."},
  {word:"voracious",pos:"adjective",def:"Wanting or devouring great quantities."},
  {word:"wary",pos:"adjective",def:"Cautious about possible dangers or problems."},
  {word:"zealot",pos:"noun",def:"A person who is fanatically devoted to a cause."},
  {word:"mellifluous",pos:"adjective",def:"Sweet or musical in tone; pleasant to hear."},
  {word:"pristine",pos:"adjective",def:"In its original condition; unspoiled."},
  {word:"pensive",pos:"adjective",def:"Engaged in serious thought (duplicate safe)."},
  {word:"candid",pos:"adjective",def:"Frank and honest in expression (duplicate safe)."}
];

// --- JOURNEYMAN (advanced / less common)
const REAL_JOURNEYMAN = [
  {word:"anachronistic",pos:"adjective",def:"Belonging to a period other than that being portrayed."},
  {word:"callipygian",pos:"adjective",def:"Having well-shaped buttocks."},
  {word:"chicanery",pos:"noun",def:"The use of trickery to achieve a purpose."},
  {word:"conflagration",pos:"noun",def:"A large destructive fire."},
  {word:"credulous",pos:"adjective",def:"Too ready to believe things; gullible."},
  {word:"effigy",pos:"noun",def:"A sculpture or model of a person."},
  {word:"equivocate",pos:"verb",def:"To use ambiguous language to conceal the truth."},
  {word:"fastidious",pos:"adjective",def:"Very attentive to detail; hard to please."},
  {word:"grandiloquent",pos:"adjective",def:"Pompous or extravagant in language or manner."},
  {word:"harangue",pos:"noun",def:"A lengthy and aggressive speech."},
  {word:"ignominious",pos:"adjective",def:"Deserving or causing public disgrace or shame."},
  {word:"indefatigable",pos:"adjective",def:"Persisting tirelessly."},
  {word:"indolent",pos:"adjective",def:"Wanting to avoid activity; lazy."},
  {word:"ineffable",pos:"adjective",def:"Too great to be expressed in words."},
  {word:"ineluctable",pos:"adjective",def:"Unable to be resisted or avoided; inevitable."},
  {word:"lethargic",pos:"adjective",def:"Lacking energy or enthusiasm; sluggish."},
  {word:"litany",pos:"noun",def:"A series of petitions; a repetitive recital."},
  {word:"lugubrious",pos:"adjective",def:"Looking or sounding sad and dismal."},
  {word:"mendacious",pos:"adjective",def:"Not telling the truth; lying."},
  {word:"obdurate",pos:"adjective",def:"Stubbornly refusing to change one's opinion."},
  {word:"obstreperous",pos:"adjective",def:"Noisy and difficult to control."},
  {word:"parsimonious",pos:"adjective",def:"Unwilling to spend money or use resources."},
  {word:"pulchritude",pos:"noun",def:"Physical beauty."},
  {word:"querulous",pos:"adjective",def:"Complaining in a petulant or whining manner."},
  {word:"revere",pos:"verb",def:"To feel deep respect or admiration for."},
  {word:"sagacious",pos:"adjective",def:"Having keen mental discernment; wise."},
  {word:"sesquipedalian",pos:"adjective",def:"Given to using long words."},
  {word:"surreptitious",pos:"adjective",def:"Kept secret, especially because it would not be approved of."},
  {word:"temerity",pos:"noun",def:"Excessive confidence or boldness; audacity."},
  {word:"trenchant",pos:"adjective",def:"Vigorous or incisive in expression or style."},
  {word:"truculent",pos:"adjective",def:"Eager or quick to argue or fight; aggressively defiant."},
  {word:"erudite",pos:"adjective",def:"Having or showing great knowledge or learning."},
  {word:"perspicacious",pos:"adjective",def:"Having a ready insight into and understanding of things."},
  {word:"obfuscate",pos:"verb",def:"To render obscure or unintelligible."},
  {word:"panacea",pos:"noun",def:"A solution or remedy for all difficulties or diseases."},
  {word:"profligate",pos:"adjective",def:"Recklessly extravagant or wasteful in the use of resources."},
  {word:"peregrinate",pos:"verb",def:"To travel or wander around from place to place."},
  {word:"conscientious",pos:"adjective",def:"Wishing to do what is right, especially in one's work."},
  {word:"pellucid",pos:"adjective",def:"Transparently clear in style or meaning."},
  {word:"recondite",pos:"adjective",def:"Little known; abstruse."}
];

// --- MASTER (very niche / obscure)
const REAL_MASTER = [
  {word:"antediluvian",pos:"adjective",def:"Ridiculously old-fashioned; literally before the biblical flood."},
  {word:"apotheosis",pos:"noun",def:"The highest point in the development of something; culmination."},
  {word:"asservate",pos:"verb",def:"To declare or affirm solemnly."},
  {word:"contumacious",pos:"adjective",def:"Stubbornly or willfully disobedient to authority."},
  {word:"disquisition",pos:"noun",def:"A long or elaborate essay or discussion on a particular subject."},
  {word:"effulgent",pos:"adjective",def:"Shining brightly; radiant."},
  {word:"excoriate",pos:"verb",def:"To criticize severely and publicly."},
  {word:"hebdomadal",pos:"adjective",def:"Occurring every seven days; weekly."},
  {word:"hebete",pos:"adjective",def:"To make dull or blunt."},
  {word:"ineffable",pos:"adjective",def:"Too great or extreme to be expressed in words (duplicate allowed)."},
  {word:"logorrhea",pos:"noun",def:"Excessive and often incoherent talkativeness or wordiness."},
  {word:"lucubration",pos:"noun",def:"Laborious study or thought, especially at night."},
  {word:"opprobrium",pos:"noun",def:"Harsh criticism or censure."},
  {word:"pervicacious",pos:"adjective",def:"Stubbornly persistent in a wrong course."},
  {word:"recidivist",pos:"noun",def:"A person who repeatedly relapses into crime."},
  {word:"recalcitrant",pos:"adjective",def:"Having an obstinately uncooperative attitude."},
  {word:"somnolent",pos:"adjective",def:"Sleepy or drowsy."},
  {word:"susurrus",pos:"noun",def:"A whispering, murmuring, or rustling sound."},
  {word:"tenebrous",pos:"adjective",def:"Dark and shadowy or obscure."},
  {word:"thaumaturgy",pos:"noun",def:"The working of wonders or miracles; magic."},
  {word:"tmesis",pos:"noun",def:"Insertion of a word or phrase between parts of a compound word."},
  {word:"solipsism",pos:"noun",def:"The theory that only the self exists or can be known to exist."},
  {word:"prelapsarian",pos:"adjective",def:"Relating to the time before the Fall of Man; idyllically innocent."},
  {word:"ineluctable",pos:"adjective",def:"Impossible to avoid or resist; inescapable (duplicate acceptable)."},
  {word:"otiose",pos:"adjective",def:"Serving no practical purpose; futile."},
  {word:"apocryphal",pos:"adjective",def:"Of doubtful authenticity, although widely circulated as true."},
  {word:"catachresis",pos:"noun",def:"The use of a word in a way that is not correct, for rhetorical effect."},
  {word:"erudition",pos:"noun",def:"The quality of having or showing great knowledge."},
  {word:"internecine",pos:"adjective",def:"Destructive to both sides in a conflict."},
  {word:"lucifugous",pos:"adjective",def:"Avoiding the light; pertaining to darkness."},
  {word:"mephitic",pos:"adjective",def:"Foul-smelling; noxious."},
  {word:"stygian",pos:"adjective",def:"Extremely dark, gloomy, or forbidding."},
  {word:"defenestrate",pos:"verb",def:"To throw someone out of a window."},
  {word:"erudite",pos:"adjective",def:"Having or showing great knowledge or learning (duplicate allowed)."}
];

// Combine into an object for easy access
const REAL_POOLS = {
  'Novice': REAL_NOVICE,
  'Apprentice': REAL_APPRENTICE,
  'Journeyman': REAL_JOURNEYMAN,
  'Master': REAL_MASTER
};

// ---------------- Fake pools (tiered; believable defs, no "supposed/fictional" language) ----------------
const FAKE_POOLS = {
  'Novice': [
    {word:"blane",pos:"noun",def:"A flat piece of metal or wood used in basic construction."},
    {word:"brint",pos:"noun",def:"A small fragment or piece broken off."},
    {word:"crel",pos:"verb",def:"To lift or raise slightly with effort."},
    {word:"drindle",pos:"verb",def:"To dwindle slowly or shrink in size."},
    {word:"farn",pos:"noun",def:"A patch of grassy or weedy ground."},
    {word:"flane",pos:"noun",def:"A thin surface layer or coating."},
    {word:"garp",pos:"verb",def:"To swallow noisily or awkwardly."},
    {word:"hindle",pos:"verb",def:"To hesitate or delay in action."},
    {word:"jarn",pos:"noun",def:"A medium-sized container made of glass or ceramic."},
    {word:"lemp",pos:"noun",def:"A small bump or swelling on a material surface."},
    {word:"mindle",pos:"verb",def:"To toy absentmindedly with something small."},
    {word:"narp",pos:"verb",def:"To snap suddenly or break apart with a sound."},
    {word:"plone",pos:"verb",def:"To press or flatten firmly."},
    {word:"quarn",pos:"noun",def:"A hand tool used for grinding or pressing."},
    {word:"rindle",pos:"noun",def:"A shallow groove or channel."},
    {word:"sarn",pos:"noun",def:"A coarse fabric used for sacks or coverings."},
    {word:"spale",pos:"noun",def:"A splinter or chip of wood."},
    {word:"tarnel",pos:"verb",def:"To stain or soil slightly."},
    {word:"velt",pos:"noun",def:"An open stretch of land with sparse vegetation."},
    {word:"zarn",pos:"noun",def:"A simple hand tool used to tighten small fastenings."},
    {word:"brast",pos:"verb",def:"To burst open suddenly."},
    {word:"tril",pos:"noun",def:"A small flat pebble used for marking paths."},
    {word:"kelth",pos:"noun",def:"A patch of tangled low brush."},
    {word:"spale",pos:"noun",def:"A narrow wooden strip used in weaving."},
    {word:"vorn",pos:"adjective",def:"Slightly crooked or bent out of shape."},
    {word:"grindle",pos:"noun",def:"Coarse meal from ground grain."},
    {word:"penn",pos:"noun",def:"A short boundary marker."},
    {word:"trast",pos:"verb",def:"To fasten loosely with a cord."},
    {word:"nelp",pos:"verb",def:"To pinch something lightly."}
  ],
  'Apprentice': [
    {word:"acrale",pos:"adjective",def:"Pertaining to the extremities or outer edges."},
    {word:"brevant",pos:"adjective",def:"Brief and to the point; concise."},
    {word:"clerant",pos:"adjective",def:"Gently luminous; shining faintly."},
    {word:"crovane",pos:"noun",def:"A carved decorative motif used in architecture."},
    {word:"dravish",pos:"adjective",def:"Harsh or grating in tone or appearance."},
    {word:"eldrine",pos:"adjective",def:"Marked by a quiet maturity of judgment."},
    {word:"ferant",pos:"adjective",def:"Bearing strength with quiet dignity."},
    {word:"gravine",pos:"noun",def:"A narrow valley or ravine."},
    {word:"halvine",pos:"adjective",def:"Partially complete; half-formed."},
    {word:"indral",pos:"noun",def:"An object used ceremonially in older rites."},
    {word:"jorvain",pos:"adjective",def:"Marked by determined effort."},
    {word:"keralin",pos:"adjective",def:"Brittle under sudden stress."},
    {word:"lurane",pos:"adjective",def:"Soft and flexible yet durable to handling."},
    {word:"morlent",pos:"adjective",def:"Having a gloomy or somber character."},
    {word:"neranth",pos:"noun",def:"A pale-flowered plant used in dried arrangements."},
    {word:"ostrel",pos:"adjective",def:"Stubbornly resistant to change."},
    {word:"pervane",pos:"noun",def:"A narrow winding passageway between buildings."},
    {word:"quarent",pos:"adjective",def:"Marked by restraint and caution."},
    {word:"relvine",pos:"adjective",def:"Closely intertwined or braided."},
    {word:"serant",pos:"noun",def:"A tool for smoothing plaster or clay surfaces."},
    {word:"tervane",pos:"adjective",def:"Prone to sudden changes of direction or mood."},
    {word:"ulmaric",pos:"adjective",def:"Noble in bearing; lofty in spirit."},
    {word:"vornel",pos:"adjective",def:"Prone to injury; delicate in constitution."},
    {word:"zeranthe",pos:"noun",def:"A pale mineral sometimes used as pigment."},
    {word:"zennor",pos:"noun",def:"A shallow basin used for rinsing small tools."},
    {word:"paltrin",pos:"noun",def:"A thread-woven strap used for tying bundles."},
    {word:"fravel",pos:"verb",def:"To fray the edge of woven fabric slightly."},
    {word:"mornel",pos:"noun",def:"A low wooden stand used for drying herbs."},
    {word:"caltrin",pos:"adjective",def:"Pertaining to coarse-grained cloth."},
    {word:"lorith",pos:"adjective",def:"Having a faintly decorative edge pattern."},
    {word:"vexlen",pos:"verb",def:"To vex or bother persistently."}
  ],
  'Journeyman': [
    {word:"adravent",pos:"adjective",def:"Boldly adventurous in manner."},
    {word:"beralith",pos:"noun",def:"A pale crystalline stone used for ornament."},
    {word:"cendralith",pos:"noun",def:"A smooth mineral used in ceremonial carving."},
    {word:"delvarine",pos:"adjective",def:"Noted for strength and durability."},
    {word:"ecravine",pos:"noun",def:"A formal written declaration or statement."},
    {word:"fornelith",pos:"noun",def:"A metallic compound used in forging."},
    {word:"geralithic",pos:"adjective",def:"Ancient in character and monumental in form."},
    {word:"horvalent",pos:"adjective",def:"Heavy and oppressive in demeanor."},
    {word:"istravane",pos:"adjective",def:"Filled with nervous or restless energy."},
    {word:"jovarenic",pos:"adjective",def:"Cheerful in expression; bright-tempered."},
    {word:"kelvarine",pos:"noun",def:"A bitter root used in traditional remedies."},
    {word:"loravine",pos:"adjective",def:"Fluent and graceful in speech."},
    {word:"meravane",pos:"noun",def:"A ceremonial feast marking the year."},
    {word:"neralithic",pos:"adjective",def:"Relating to large stone structures."},
    {word:"obravanic",pos:"adjective",def:"Stubbornly unyielding in stance."},
    {word:"peravane",pos:"noun",def:"An intricate instrumental composition."},
    {word:"querentis",pos:"adjective",def:"Full of yearning or desire."},
    {word:"rovantine",pos:"adjective",def:"Impressive and majestic in aspect."},
    {word:"servolant",pos:"adjective",def:"Moving in a smooth, gliding manner."},
    {word:"torvalith",pos:"noun",def:"A dark mineral used in toolmaking."},
    {word:"ulvarian",pos:"adjective",def:"Having predatory or wolf-like qualities."},
    {word:"valerinth",pos:"adjective",def:"Steadfast and resolute in character."},
    {word:"xeravant",pos:"adjective",def:"Dry and barren in landscape."},
    {word:"zeraphine",pos:"noun",def:"A pale nocturnal flower valued for scent."},
    {word:"caldrin",pos:"verb",def:"To temper metal by controlled heating."},
    {word:"mornith",pos:"noun",def:"A small ceremonial tool used in weaving."},
    {word:"palven",pos:"noun",def:"A shallow bowl used for offerings."},
    {word:"torvane",pos:"noun",def:"A venting vane used for air flow."},
    {word:"ceralith",pos:"noun",def:"An ornamental stone inlay."},
    {word:"jorvane",pos:"adjective",def:"Marked by rigid discipline."}
  ],
  'Master': [
    {word:"acrivalent",pos:"adjective",def:"Surpassing ordinary limits of achievement."},
    {word:"belmorithic",pos:"adjective",def:"Grand and richly ornamented in design."},
    {word:"ceravinthian",pos:"adjective",def:"Possessing a mystical or subtle quality."},
    {word:"drosvalerian",pos:"adjective",def:"Firmly rooted in ancient tradition or custom."},
    {word:"eldrovantic",pos:"adjective",def:"Difficult to interpret; shrouded in mystery."},
    {word:"ferulentine",pos:"adjective",def:"Severe in discipline and practice."},
    {word:"gravothian",pos:"adjective",def:"Immense and weighty in presence."},
    {word:"horvalithian",pos:"adjective",def:"Resonant and echoing in tone."},
    {word:"intravellian",pos:"adjective",def:"Liminal, existing between distinct realms."},
    {word:"jorvalentian",pos:"adjective",def:"Pertaining to noble lineage or tradition."},
    {word:"kraventhoric",pos:"adjective",def:"Chaotic and unpredictable in force."},
    {word:"loravinthian",pos:"adjective",def:"Richly poetic or highly expressive."},
    {word:"melvorantine",pos:"adjective",def:"Bitter in tone or temper."},
    {word:"neravinthian",pos:"adjective",def:"Rare and prized for beauty."},
    {word:"obrellanthic",pos:"adjective",def:"Harsh and unyielding in character."},
    {word:"pervalorian",pos:"adjective",def:"Shining with a radiant brilliance."},
    {word:"quorvalithic",pos:"adjective",def:"Monumental in scale and impact."},
    {word:"ravellanthine",pos:"adjective",def:"Complex; weaving many elements together."},
    {word:"seravinthian",pos:"adjective",def:"Sacred and venerated."},
    {word:"torvellanthian",pos:"adjective",def:"Enduring across countless ages."},
    {word:"ulthraventine",pos:"adjective",def:"Transcending common human understanding."},
    {word:"velmorinthian",pos:"adjective",def:"Elegant and refined in style."},
    {word:"xorvalenthian",pos:"adjective",def:"Strange and alien in nature."},
    {word:"zeravinthian",pos:"adjective",def:"Exemplary of purity or perfection."},
    {word:"novastine",pos:"noun",def:"A crystalline deposit found along certain coasts."},
    {word:"quarionel",pos:"adjective",def:"Pertaining to ceremonial rites."},
    {word:"trenvorine",pos:"adjective",def:"Shifting in pattern like running water."},
    {word:"avalricone",pos:"noun",def:"A horned instrument used in rituals."},
    {word:"zoltheronic",pos:"adjective",def:"Tinged with a faint metallic sheen."},
    {word:"threnodalic",pos:"adjective",def:"Mournful in tone or expression."},
    {word:"plenarithic",pos:"adjective",def:"Massive and enduring in structure."},
    {word:"xaldemorine",pos:"noun",def:"An elaborately crafted ceremonial chalice."},
    {word:"vornathriel",pos:"noun",def:"A legendary sword of old tales."},
    {word:"joraventine",pos:"adjective",def:"Stern but noble in bearing."}
  ]
};

// ---------- Usage tracking for freshness ----------
let usedReal = new Set();   // strings of used real words (across all tiers)
let usedFake = new Set();   // used fake words

// ---------- Game state ----------
let currentSet = []; // array of 4 items: {word,pos,def,isReal}
let setIndexInBlock = 0; // 0..2
let globalSetNumber = 1;
let tierPoints = 0; // points in current block
let toolboxUsedThisBlock = false;
let toolboxActive = false;
let setAnswered = false;
let masterWon = false;

// ---------- UI refs ----------
const wordsDiv = document.getElementById('words');
const messageDiv = document.getElementById('message');
const explainDiv = document.getElementById('explain');
const useToolboxBtn = document.getElementById('useToolbox');
const nextBtn = document.getElementById('nextBtn');
const tierLabel = document.getElementById('tierLabel');
const tierPill = document.getElementById('tierPill');
const tierPointsPill = document.getElementById('tierPointsPill');
const setPill = document.getElementById('setPill');
const setInBlockLabel = document.getElementById('setInBlock');
const tierPtsLabel = document.getElementById('tierPts');
const tbAvailLabel = document.getElementById('tbAvail');
const globalSetLabel = document.getElementById('globalSet');

// ---------- Utility functions ----------
function poolFor(tier){
  return REAL_POOLS[tier];
}
function fakePoolFor(tier){
  return FAKE_POOLS[tier];
}
function ensureCandidates(poolArray, usedSet, needed){
  const candidates = poolArray.filter(item => !usedSet.has(item.word));
  if(candidates.length < needed){
    // recycle used items for that pool only: remove from usedSet any words present in poolArray
    poolArray.forEach(it => usedSet.delete(it.word));
    return poolArray.slice();
  }
  return candidates;
}
function pickNUnique(arr, n){
  // arr: array of objects; pick n unique randomly (without modifying original)
  const copy = arr.slice();
  shuffle(copy);
  return copy.slice(0,n);
}

// ---------- Create a new set ----------
function createSet(){
  const tier = TIERS[tierIndex];
  // Ensure candidate real words are fresh
  let realPool = poolFor(tier);
  let realCandidates = ensureCandidates(realPool, usedReal, 3);
  realCandidates = shuffle(realCandidates).slice(0,3);
  // Mark them used
  realCandidates.forEach(r => usedReal.add(r.word));

  // Pick a fake from the fake tier pool (fresh)
  let fakeCandidates = ensureCandidates(fakePoolFor(tier), usedFake, 1);
  const fakePick = shuffle(fakeCandidates)[0];
  usedFake.add(fakePick.word);

  // Build combined set and shuffle display order
  const combined = [
    {word: realCandidates[0].word, pos: realCandidates[0].pos, def: realCandidates[0].def, isReal:true},
    {word: realCandidates[1].word, pos: realCandidates[1].pos, def: realCandidates[1].def, isReal:true},
    {word: realCandidates[2].word, pos: realCandidates[2].pos, def: realCandidates[2].def, isReal:true},
    {word: fakePick.word, pos: fakePick.pos, def: fakePick.def, isReal:false}
  ];
  shuffle(combined);
  currentSet = combined;
  // setAnswered false etc.
  setAnswered = false;
  toolboxActive = false;
  // Update UI
  renderCurrentSet();
}

// ---------- Render current set ----------
function renderCurrentSet(){
  wordsDiv.innerHTML = "";
  explainDiv.innerHTML = "";
  messageDiv.innerHTML = "";
  nextBtn.disabled = true;
  useToolboxBtn.disabled = toolboxUsedThisBlock || false;
  tbAvailLabel.textContent = toolboxUsedThisBlock ? "No" : "Yes";
  tierLabel.textContent = TIERS[tierIndex];
  tierPill.textContent = `Tier: ${TIERS[tierIndex]}`;
  tierPointsPill.textContent = `Tier points: ${tierPoints}`;
  setPill.textContent = `Set: ${setIndexInBlock+1}/3`;
  setInBlockLabel.textContent = `${setIndexInBlock+1} / 3`;
  tierPtsLabel.textContent = tierPoints;
  globalSetLabel.textContent = globalSetNumber;

  // Build buttons with stable numbering 1..4 for this set
  currentSet.forEach((item, idx) => {
    const row = document.createElement('div');
    row.className = 'row';
    const num = document.createElement('div');
    num.className = 'num';
    num.textContent = idx+1;
    const btn = document.createElement('button');
    btn.className = 'btn';
    btn.id = 'wordBtn' + (idx+1);
    btn.dataset.index = idx;
    btn.innerHTML = `<div style="font-weight:700">${item.word}</div><div class="small">${item.pos} — ${item.def}</div>`;
    btn.addEventListener('click', ()=> handleWordClick(idx));
    row.appendChild(num);
    row.appendChild(btn);
    wordsDiv.appendChild(row);
  });

  // If toolbox is currently active, visually hint (but normally not)
  explainDiv.textContent = toolboxActive ? 'Toolbox active — tap a numbered word to reveal whether it is real or fake.' : '';
}

// ---------- Handle word click (Toolbox reveal vs guess) ----------
function handleWordClick(idx){
  if(setAnswered) return; // already guessed this set
  const item = currentSet[idx];
  const btn = document.getElementById('wordBtn' + (idx+1));
  if(toolboxActive){
    // Reveal whether REAL or FAKE — no penalty. Toolbox consumed.
    const wasReal = item.isReal;
    toolboxUsedThisBlock = true;
    toolboxActive = false;
    useToolboxBtn.disabled = true;
    tbAvailLabel.textContent = "No";
    // Visual reveal: green outline for fake (helpful), red/gray for real
    if(wasReal){
      btn.style.outline = '2px solid rgba(255,107,107,0.15)'; // real = red-ish (so you know it's not the fake)
      showMessage(`🔍 Toolbox: "${item.word}" is REAL.`, false);
    } else {
      btn.style.outline = '2px solid rgba(46,204,113,0.18)'; // fake = green-ish
      showMessage(`🔍 Toolbox: "${item.word}" is FAKE.`, true);
    }
    // remove dashed border if any
    Array.from(document.querySelectorAll('.btn')).forEach(b=> b.style.border='1px solid rgba(255,255,255,0.04)');
    // After reveal, user still must make the normal guess for this set.
    return;
  }

  // Normal guess flow
  setAnswered = true;
  // Disable all buttons
  Array.from(document.querySelectorAll('.btn')).forEach(b => b.classList.add('disabled'));
  // Check if correct (clicked word is fake)
  if(!item.isReal){
    // Correct
    tierPoints++;
    showMessage(`✅ Correct — "${item.word}" was the fake.`, true);
  } else {
    showMessage(`❌ Nope — "${item.word}" is a real word.`, false);
  }
  // Reveal the fake visually
  currentSet.forEach((it, i)=>{
    const b = document.getElementById('wordBtn' + (i+1));
    if(!b) return;
    if(!it.isReal){
      b.style.outline = '2px solid rgba(46,204,113,0.18)';
    } else {
      b.style.opacity = '0.95';
    }
  });

  // enable Next
  nextBtn.disabled = false;
  // update UI counters
  tierPointsPill.textContent = `Tier points: ${tierPoints}`;
  tierPtsLabel.textContent = tierPoints;
}

// ---------- Message helper ----------
function showMessage(text, ok){
  messageDiv.innerHTML = `<div class="msg ${ok? 'ok':'bad'}">${text}</div>`;
}

// ---------- Toolbox button ----------
useToolboxBtn.addEventListener('click', ()=>{
  if(toolboxUsedThisBlock){
    alert("Toolbox already used this block.");
    return;
  }
  if(setAnswered){
    alert("This set already answered — toolbox can only be used before guessing on a set.");
    return;
  }
  toolboxActive = true;
  // hint visually
  Array.from(document.querySelectorAll('.btn')).forEach(b => b.style.border='2px dashed #ffcc66');
  explainDiv.textContent = 'Toolbox active — tap a numbered word to reveal whether it is real or fake (no penalty).';
});

// ---------- Next button ----------
nextBtn.addEventListener('click', ()=>{
  if(!setAnswered){
    alert("You must guess the fake or use the Toolbox then guess before moving on.");
    return;
  }
  // Advance counters
  globalSetNumber++;
  setIndexInBlock++;
  if(setIndexInBlock >= 3){
    // block finished -> Forge Word flow
    presentForgeWord();
  } else {
    // new set in same block
    createSet();
  }
});

// ---------- Forge Word ----------
function presentForgeWord(){
  // Choose a Forge word: randomly pick from either REAL or FAKE pool for current tier, preferring unused
  const tier = TIERS[tierIndex];
  const realCandidates = REAL_POOLS[tier].filter(it => !usedReal.has(it.word));
  const fakeCandidates = FAKE_POOLS[tier].filter(it => !usedFake.has(it.word));

  let useFake = Math.random() < 0.5;
  // if chosen pool empty, flip
  if(useFake && fakeCandidates.length === 0) useFake = false;
  if(!useFake && realCandidates.length === 0) useFake = true;
  // fallback: if both empty, allow reuse
  let forgeWordObj;
  if(useFake){
    const pick = fakeCandidates.length ? pickRandom(fakeCandidates) : pickRandom(FAKE_POOLS[tier]);
    forgeWordObj = {word: pick.word, pos: pick.pos, def: pick.def, isReal:false};
    usedFake.add(pick.word);
  } else {
    const pick = realCandidates.length ? pickRandom(realCandidates) : pickRandom(REAL_POOLS[tier]);
    forgeWordObj = {word: pick.word, pos: pick.pos, def: pick.def, isReal:true};
    usedReal.add(pick.word);
  }

  // Show Forge UI in explainDiv with two buttons
  explainDiv.innerHTML = `<div class="forgeBox"><strong>Forge Word:</strong> <span style="font-weight:700">${forgeWordObj.word}</span> — ${forgeWordObj.pos} — ${forgeWordObj.def}
    <div style="margin-top:8px">
      <button id="forgeRealBtn">Real</button>
      <button id="forgeFakeBtn" style="margin-left:8px">Fake</button>
    </div></div>`;

  // disable main controls while forge pending
  nextBtn.disabled = true;
  useToolboxBtn.disabled = true;

  document.getElementById('forgeRealBtn').addEventListener('click', ()=>{
    const correct = forgeWordObj.isReal === true;
    if(correct){
      tierPoints++;
      showMessage('✅ Forge correct! +1 tier point.', true);
    } else {
      showMessage('✳️ Forge incorrect (no penalty).', false);
    }
    // finalize block after short pause
    setTimeout(()=> finalizeBlock(), 850);
  });
  document.getElementById('forgeFakeBtn').addEventListener('click', ()=>{
    const correct = forgeWordObj.isReal === false;
    if(correct){
      tierPoints++;
      showMessage('✅ Forge correct! +1 tier point.', true);
    } else {
      showMessage('✳️ Forge incorrect (no penalty).', false);
    }
    setTimeout(()=> finalizeBlock(), 850);
  });
}

// ---------- Finalize block (apply tier movement) ----------
function finalizeBlock(){
  // Determine movement based on tierPoints (after Forge)
  const points = tierPoints;
  let move = 0;
  if(points >= 3) move = 1;
  else if(points === 2) move = 0;
  else move = -1;

  const oldTier = tierIndex;
  if(move === 1 && tierIndex < TIERS.length - 1){
    tierIndex++;
  } else if(move === -1 && tierIndex > 0){
    tierIndex--;
  }

  // Check Master win condition: if we were in Master and achieved 3+ points, that's a win.
  if(oldTier === TIERS.length - 1 && points >= 3){
    masterWon = true;
    showMessage('🏆 YOU WIN WORDSMITH! You completed Master with 3+ points!', true);
    explainDiv.innerHTML = `<div class="small">Victory! Click "New Game" to play again.</div>`;
    renderEndOptions();
    return;
  }

  // Reset for next block
  setIndexInBlock = 0;
  tierPoints = 0;
  toolboxUsedThisBlock = false;
  toolboxActive = false;
  setAnswered = false;
  // Update UI & show movement message
  explainDiv.innerHTML = `<div class="small">Block complete. You scored ${points}/3. Tier: ${TIERS[oldTier]} → ${TIERS[tierIndex]}.</div>`;
  tierLabel.textContent = TIERS[tierIndex];
  tierPill.textContent = `Tier: ${TIERS[tierIndex]}`;
  tierPointsPill.textContent = `Tier points: ${tierPoints}`;
  tbAvailLabel.textContent = toolboxUsedThisBlock ? "No" : "Yes";
  setPill.textContent = `Set: ${setIndexInBlock+1}/3`;
  tierPtsLabel.textContent = tierPoints;

  // Start next block after a short delay
  setTimeout(()=>{
    createSet();
  }, 1000);
}

// ---------- End / New Game ----------
function renderEndOptions(){
  // Add a New Game button below
  const f = document.querySelector('footer');
  if(!f) return;
  f.innerHTML = `<div class="small" style="margin-top:8px">Game over. <button id="newGameBtn">New Game</button></div>`;
  document.getElementById('newGameBtn').addEventListener('click', ()=> location.reload());
}

// ---------- Start & initialization ----------
function startGame(){
  tierIndex = 0;
  setIndexInBlock = 0;
  globalSetNumber = 1;
  tierPoints = 0;
  toolboxUsedThisBlock = false;
  toolboxActive = false;
  setAnswered = false;
  masterWon = false;
  // clear used sets
  usedReal.clear();
  usedFake.clear();
  // initial render
  createSet();
}

window.addEventListener('load', startGame);

</script>
</body>
</html>